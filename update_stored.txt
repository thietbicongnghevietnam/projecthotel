loi from dang nhap toart chua hien.....
code signalr
https://stackoverflow.com/questions/18143599/can-signalr-be-used-with-asp-net-webforms
===========================
******- nut sua hoa don: tao mot nut luu lai, bat phai ghi hoa don xong thi moi refresh trang thai sua . ==> neu khong se qua lai ton kho nhu cu

===== // co so du lieu theo sql 2010 //=====  PSNV sql sa:Psnv123456
//xu ly sql o ngoai : //"exec1986"

===== stored

NH_dongia_cauthanh_dvt
NH_insert_cauthanhdvt
NH_update_cauthanhdvt
NH_getdongia_cauthanh

============================

USE [DataBanHang]
GO
/****** Object:  StoredProcedure [dbo].[NH_check_cauthanh_dvt]    Script Date: 07/06/2024 23:28:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[NH_check_cauthanh_dvt]--NH_check_cauthanh_dvt N'Bột Soda baking'
	@mahang as nvarchar(500),
	@dvt as nvarchar(50)
AS
BEGIN

	if exists(select id from hthanghoa where tenhang = @mahang and cauthanhsanpham=1)
	begin
		-- co cau thanh san pham
		if exists(select id from hthanghoa where tenhang = @mahang and dvt=@dvt)
		begin
			--co cau thanh -> nhung van ban theo don vi tinh nho
			select 0
		end
		else
		begin
			-- don vi tinh da bi thay doi
			select 1
		end		
	end
	else
	begin
		-- khong co cau thanh san pham
		select 0
	end	

END

==================
USE [DataNhaHang]
GO
/****** Object:  StoredProcedure [dbo].[NH_DMCauthanhDVT]    Script Date: 07/06/2024 21:46:02 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create PROCEDURE [dbo].[NH_DMCauthanhDVT_timkiem]
	@tenhang as nvarchar(50)
AS
BEGIN
	
declare @mahang as nvarchar(50)
set @mahang = (select mahang from hthanghoa where tenhang=@tenhang)

select top 100 a.id,a.mahang,a.dvtto,a.soluongqudoi,a.dvtnho,a.gianhap,a.giaban,a.giabuon,a.giaban2,
(select b.tenhang from hthanghoa b where b.mahang = a.mahang ) as tenhang from htdonvitinh a where a.mahang = @mahang


END

========
USE [DataNhaHang]
GO
/****** Object:  StoredProcedure [dbo].[NH_DMCauthanhDVT]    Script Date: 07/06/2024 21:46:36 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[NH_DMCauthanhDVT]

AS
BEGIN
	--select * from htdonvitinh
select top 200 a.id,a.mahang,a.dvtto,a.soluongqudoi,a.dvtnho,a.gianhap,a.giaban,a.giabuon,a.giaban2,
(select b.tenhang from hthanghoa b where b.mahang = a.mahang ) as tenhang from htdonvitinh a order by a.createdate desc
END



===============
1. fix loi hoa don dau tien click view hoa don khong update trang thai phong
NH_save_thongtinhanghoa
....update htphong set trangthai='1' where tenphong=@tenphong
=================
2. fix loi sua truc tiep tren bang
USE [DataNhaHang]
GO
/****** Object:  Trigger [dbo].[PreventUpdate]    Script Date: 06/11/2024 10:14:27 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER TRIGGER [dbo].[PreventUpdate]
   ON  [dbo].[htsocai]
   INSTEAD OF UPDATE
AS 
BEGIN

	declare @sohd nvarchar(50)
	declare @type tinyint
	declare @ngaygiothue datetime
	declare @ngaygiora datetime
	declare @tongthoigianthue as nvarchar(50)
	declare @tenkhachhang as nvarchar(50)
	declare @tenphong as nvarchar(50)
	declare @giaphong as float
	declare @tiencoc as float
	declare @tienphong as float
	declare @tiengiohat as float
	declare @tienhang as float
	declare @tongtien as float
	declare @chietkhau as float
	declare @ckthoigian as float
	declare @tiensauchietkhau as float
	declare @psco as float
	declare @psno as float
	declare @hinhthucnghi as int
	declare @mohinh as int
	declare @items as nvarchar(500)
	declare @listtoncuoiky as nvarchar(500)
	declare @songuoio int
	declare @ghichu as nvarchar(50)
	declare @idnhanvien as nvarchar(50)
	declare @idncc as int
	declare @Flag as nvarchar(10)
	declare @userid as nvarchar(50)
	declare @created as datetime
	declare @modified as datetime



	 
    IF OBJECTPROPERTY(OBJECT_ID('TRIGGER_NESTLEVEL'), 'ExecIsAnsiNullsOn') = 0
    BEGIN       
        RAISERROR ('Không được phép cập nhật trực tiếp bảng này.', 16, 1)
    END
    ELSE
    BEGIN 	
						SELECT @sohd = sohd, @type = [type],@ngaygiothue=ngaygiothue,@ngaygiora=ngaygiora,@tongthoigianthue=tongthoigianthue,@tenkhachhang=@tenkhachhang,@tenphong=tenphong,@giaphong=giaphong,
						@tiencoc=tiencoc,@tienphong=tienphong,@tiengiohat=tiengiohat,@tienhang=tienhang,@tongtien=tongtien,@chietkhau=chietkhau,@ckthoigian=ckthoigian,@tiensauchietkhau=tiensauchietkhau,
						@psco=psco,@psno=psno,@hinhthucnghi=hinhthucnghi,@mohinh=mohinh,@items=items,@listtoncuoiky=listtoncuoiky,@songuoio=songuoio,@ghichu=ghichu,@idnhanvien=idnhanvien,@idncc=idncc,
						@Flag=Flag,@userid=userid,@created=created
					FROM Inserted

					--SELECT @sohd = sohd FROM Inserted

						UPDATE htsocai
						SET 
							sohd = @sohd,
							[type] = @type,
							ngaygiothue = @ngaygiothue,
							ngaygiora = (SELECT ngaygiora FROM Inserted),
							tongthoigianthue = (SELECT tongthoigianthue FROM Inserted),
							tenkhachhang = @tenkhachhang,
							tenphong = @tenphong,
							giaphong = @giaphong,
							tiencoc = (SELECT tiencoc FROM Inserted),
							tienphong = (SELECT tienphong FROM Inserted),
							tiengiohat =(SELECT tiengiohat FROM Inserted),
							tienhang = (SELECT tienhang FROM Inserted),
							tongtien = (SELECT tongtien FROM Inserted),
							chietkhau = (SELECT chietkhau FROM Inserted),
							ckthoigian = (SELECT ckthoigian FROM Inserted),
							tiensauchietkhau = (SELECT tiensauchietkhau FROM Inserted),
							psco = (SELECT psco FROM Inserted),
							psno = (SELECT psno FROM Inserted),
							hinhthucnghi = (SELECT hinhthucnghi FROM Inserted),
							mohinh = (SELECT mohinh FROM Inserted),
							items = (SELECT items FROM Inserted), 
							listtoncuoiky = (SELECT listtoncuoiky FROM Inserted), 
							songuoio = @songuoio,
							ghichu = @ghichu,
							idnhanvien = (SELECT idnhanvien FROM Inserted),
							idncc = @idncc,
							Flag = (SELECT Flag FROM Inserted),
							userid = @userid,
							created = @created
							WHERE sohd=@sohd


    END

END



============================

USE [DataNhaHang]
GO
/****** Object:  Trigger [dbo].[PreventDelete]    Script Date: 06/11/2024 10:39:04 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER TRIGGER [dbo].[PreventDelete] 
   ON  [dbo].[htsocai]
   INSTEAD OF DELETE
AS 
BEGIN
	RAISERROR ('ERR D', 16, 1)

END


============================



==== loi nut sua hoa don ===
$('.editproduct').click(function () {

=============


=============
BACKUP DATABASE FOSS1 TO DISK = '\\10.92.184.233\e\Backup\DBS\FOSS1.bak' WITH INIT
BACKUP DATABASE [DataNhaHang] TO DISK = 'D:\Database\backup\DataNhaHang.bak' WITH INIT


===============  cach distinct ben client
  <%int i = 0; %>
        <%System.Data.DataView view = new System.Data.DataView(dt_home);
            System.Data.DataTable distinctMater;
            if (drop_board.Text == "Resin map board")
            {
                distinctMater = view.ToTable(true, "MATER_NAME", "MATER_MAKER_CODE", "MATER_VENDOR_CODE", "MATER_VENDOR_NAME", "MATER_GR", "MATER_TYPE", "MATER_COLOR");
            }
            else
            {
                //distinctMater = view.ToTable(true, "MATER_NAME_RECYCLE", "MATER_MAKER_CODE", "MATER_VENDOR_CODE", "MATER_VENDOR_NAME", "MATER_GR", "MATER_TYPE", "MATER_COLOR", "STOCK_LOC");
                distinctMater = view.ToTable(true, "MATER_NAME_RECYCLE", "MATER_MAKER_CODE", "MATER_VENDOR_CODE", "MATER_VENDOR_NAME", "MATER_GR", "MATER_TYPE", "MATER_COLOR");
            }   %>
        <%foreach (System.Data.DataRow mater in distinctMater.Rows)
            { %>
        <%i++;%>
        <div class="col-sm-3 col-md-2" id="card_<%=i %>">
            <div class="card shadow-sm mb-4" style="background-color: wheat;">
                <div class="card-body text-white">
                    <select multiple class="form-control" style="height: 60px; background-color: wheat">
                        <%foreach (System.Data.DataRow loc in dt_home.Rows)
                            {%>
                        <%if (drop_board.Text == "Resin map board")
                            {
                                if (loc["MATER_NAME"].ToString() == mater["MATER_NAME"].ToString())
                                {%>
                        <option style="font-size: 16px;" data-toggle="tooltip" data-placement="top" title="<%= loc["DT_REC"].ToString()!="" ? loc["LOT_NO"].ToString() + ":" + loc["DT_REC"].ToString(): loc["LOT_NO"].ToString() %>  ">
                            <%= loc["STOCK_LOC"].ToString() + ":" + loc["STOCK_GOOD_QTY"].ToString() %>
                            <%if (loc["LOT_NO"].ToString().Trim() != "")
                                {%>
                            <%if (loc["LOT_NO"].ToString().Trim() != "TraKho")
                                {%>
                                                              \<%= loc["DT_REC"].ToString() != "" ? loc["LOT_NO"].ToString() + ":" + loc["DT_REC"].ToString() : loc["LOT_NO"].ToString() %>
                            <%}
                            else
                            { %>
                                                              \<%= loc["LOT_NO"].ToString() %>
                            <%} %>
                            <%} %>
                        </option>
                        <%}%>
                        <%}
                            else
                            {
                                if (loc["MATER_NAME_RECYCLE"].ToString() == mater["MATER_NAME_RECYCLE"].ToString())
                                {%>

                        <option style="font-size: 16px;" data-toggle="tooltip" data-placement="top" title="<%= loc["STOCK_LOC"].ToString() + ":" + loc["STOCK_GOOD_QTY"].ToString() %>">
                            <%= loc["STOCK_LOC"].ToString() + ":" + loc["STOCK_GOOD_QTY"].ToString()  %>                                                                                       
                        </option>

                        <%}%>
                        <%}
                            }%>
                    </select>
                </div>
                <div class="card-footer text-center text-white" id="<%=i %>" style="color: azure;">
                    <%if (drop_board.Text == "Resin map board")
                        {%>
                    <h6 style="font-size: 20px;"><a href="#" onclick="ShowModal('<%= mater["MATER_NAME"].ToString() %>','<%= mater["MATER_MAKER_CODE"].ToString() %>','<%= mater["MATER_VENDOR_CODE"].ToString() %>','<%= mater["MATER_VENDOR_NAME"].ToString() %>','<%= mater["MATER_GR"].ToString() %>','<%= mater["MATER_TYPE"].ToString() %>','<%= mater["MATER_COLOR"].ToString() %>')" data-toggle="tooltip" style="color: white;"><%=mater["MATER_NAME"].ToString() %></a></h6>
                    <%}
                    else
                    { %>
                    <h6 style="font-size: 18px;">
                        <a href="#" onclick="ShowModal('<%= mater["MATER_NAME_RECYCLE"].ToString() %>','<%= mater["MATER_MAKER_CODE"].ToString() %>','<%= mater["MATER_VENDOR_CODE"].ToString() %>','<%= mater["MATER_VENDOR_NAME"].ToString() %>','<%= mater["MATER_GR"].ToString() %>','<%= mater["MATER_TYPE"].ToString() %>','<%= mater["MATER_COLOR"].ToString() %>')" data-toggle="tooltip" style="color: white;"><%=mater["MATER_NAME_RECYCLE"].ToString() %></a>
                        :<a href="#" onclick="return ShowPopUp('<%=mater["MATER_NAME_RECYCLE"].ToString() %>','<%=mater["MATER_NAME_RECYCLE"].ToString() %>')">
                            <b style="font-size: 14px; color: black">Detail LotNo</b>
                        </a>
                    </h6>
                    <%} %>
                </div>
            </div>
        </div>
        <%if (i % 6 == 0)
            {%>
        <div style="clear: both;"></div>
        <%}%>
        <%}%>
    </div>
