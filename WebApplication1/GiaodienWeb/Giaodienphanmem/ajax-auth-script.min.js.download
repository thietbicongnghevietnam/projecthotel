jQuery(document).ready(function($){function change_captcha(){document.getElementById("captcha").src=php_vars.template_uri+"/recaptcha/get_captcha.php?rnd="+Math.random()}var wh=$(window).height(),ww=$(window).width();$("#popup_signup").removeClass("popup_success"),$("#ajax-captcha-refresh").click(function(){change_captcha()}),$("#popup_signup .fa-times-circle, .dang-ky .fa-times-circle").on("click",function(){return $("#popup_signup").fadeOut(500,function(){$(".login_overlay").hide(),jQuery("body").removeClass("bd-hd")}),$(".dang-ky .success").fadeOut(500),!1}),$("#show_signup").on("click",function(e){$(".login_overlay").show(),$("#popup_signup").fadeIn(500),e.preventDefault(),$("#popup_signup").height()>.85*wh&&$("#popup_signup").css("max-height",parseInt(wh)),jQuery("body").addClass("bd-hd")}),$("#show_signup2").on("click",function(e){$(".login_overlay").show(),$("#popup_signup").fadeIn(500),e.preventDefault(),$("#popup_signup").height()>.85*wh&&$("#popup_signup").css("max-height",parseInt(wh)),jQuery("body").addClass("bd-hd")}),$("#show_signup3").on("click",function(e){$(".dangky-title").parents(".page-template-register-php").length>0?$("#fullname").focus():($(".login_overlay").show(),$("#popup_signup").fadeIn(500),e.preventDefault(),$("#popup_signup").height()>.85*wh&&$("#popup_signup").css("max-height",parseInt(wh)),jQuery("body").addClass("bd-hd"))}),$("#show_signup4").on("click",function(e){$(".login_overlay").show(),$("#popup_signup").fadeIn(500),e.preventDefault(),$("#popup_signup").height()>.85*wh&&$("#popup_signup").css("max-height",parseInt(wh)),jQuery("body").addClass("bd-hd")}),$("#show_signup5").on("click",function(e){$(".login_overlay").show(),$("#popup_signup").fadeIn(500),e.preventDefault(),$("#popup_signup").height()>.85*wh&&$("#popup_signup").css("max-height",parseInt(wh)),jQuery("body").addClass("bd-hd")});var loginToken,code,isCaptchaValid;$("#register").on("submit",function(e){return isCaptchaValid=!1,captcha_code=$("#captcha-code").val(),code=$("#http").val(),fullname=$("#fullname").val(),email=$("#email").val(),phone=$("#phone").val(),companyname=$("#companyname").val(),username=$("#username").val(),password=$("#password").val(),zone=$("#zone").val(),indust=$("#industry").val(),id_source=$("#id_source").val(),lead_source_description=$("#id_source_description").val(),refered_by=$("#id_refered_by").val(),intRegex=/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/,phone.length<6||phone.length>11||!intRegex.test(phone)?($("#phone").focus(),$(".msg-error").html("Số điện thoại không hợp lệ.").attr("style","color:red"),!1):($(".msg-error").html("").removeAttr("style"),""==zone?!1:($("#success_companyname").html(companyname),$("#success_username").html(username),$("#success_password").html(password),$("#success_code").html("http://"+code+"."+php_vars.KVURL),$.ajax({url:php_vars.template_uri+"/recaptcha/checkCaptcha.php",type:"POST",async:!1,dataType:"text",data:{captcha_code:captcha_code,code:code},success:function(resp){if(0==resp){switch(isCaptchaValid=!0,industry=indust,parseInt(indust)){case 77:industry=10;break;case 19:industry=1;break;case 15:industry=2;break;case 63:industry=9;break;case 65:industry=7;break;case 75:industry=3;break;case 61:industry=9;break;case 73:industry=4;break;case 67:industry=7;break;case 69:industry=6;break;case 71:industry=5;break;case 9:industry=11;break;case 3472:industry=12;break;case 3949:industry=15;break;case 1984:industry=0}$("#ldng").show(),$.ajax({type:"POST",url:php_vars.site_uri+"/kiotviet.php",data:{demo:{type:0,fullname:fullname,email:email,phone:phone,companyname:companyname,captcha_code:captcha_code,code:code,username:username,password:password,zone:zone,industry:industry,lead_source:id_source,lead_source_description:lead_source_description,refered_by:refered_by}},success:function(e){e.SessionKey?($("#ldng").hide(),$(".register-wr").hide(),$(".page-register-wr").show(),$("#popup_signup").addClass("popup_success").css("max-height","inherit"),$(".success").show(),$(".dangky-title").hide(),$(".dangkysuccess").show(),$(".dangky-title").length>0&&$(".dangky-title").parents(".page-template-register-php").length>0&&$("html body").animate({scrollTop:$(".dangky-title.dangkysuccess").offset().top-$(".dangky-title.dangkysuccess").height()},100),loginToken=encodeURIComponent(e.SessionKey),$.ajax({type:"POST",url:php_vars.site_uri+"/dang-ky-popup/",data:{request:{type:0,fullname:fullname,email:email,phone:phone,companyname:companyname,captcha_code:captcha_code,code:code,username:username,password:password,zone:zone,industry:indust,lead_source:id_source,lead_source_description:lead_source_description,refered_by:refered_by}},success:function(){},dataType:"json"})):($("#ldng").hide(),$(".register-wr, .registerTop").show(),$(".msg-error").html(e.ResponseStatus.Message).attr("style","color:red"),document.getElementById("captcha").src=php_vars.template_uri+"/recaptcha/get_captcha.php?rnd="+Math.random()),console.log(e)},dataType:"json",error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err)}})}else $("#ldng").hide(),$(".msg-error").html("Sai mã xác nhận").attr("style","color:red"),document.getElementById("captcha").src=php_vars.template_uri+"/recaptcha/get_captcha.php?rnd="+Math.random()},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err)}}),e.preventDefault(),!1))}),$("#btnSuccess").on("click",function(e){shop_url="http://"+code+"."+php_vars.KVURL+"/Login?loginToken="+loginToken,window.location=shop_url,e.preventDefault()})});